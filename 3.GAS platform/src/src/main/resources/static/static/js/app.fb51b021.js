(function(){"use strict";var e={3914:function(e,t,a){var o=a(6848),n=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},i=[],s=(0,o.defineComponent)({__name:"App",setup(e){return{__sfc:!0}}}),l=s,r=a(1656),c=(0,r.A)(l,n,i,!1,null,null,null),u=c.exports,d=a(6178),h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("div",{staticClass:"head_box"},[t("span",[e._v("目录：")]),t("el-select",{attrs:{placeholder:"请选择",clearable:"",filterable:""},on:{change:e.handleChange},model:{value:e.catalog,callback:function(t){e.catalog=t},expression:"catalog"}},e._l(e.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.catalog?t("div",{staticStyle:{"margin-left":"20px"}},[e._v("缩放倍数："+e._s(e.zoom)+"X")]):e._e(),t("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("切割")])],1),e.catalog&&e.isLoad?["0"===e.type||"1"===e.type?t("div",{staticClass:"content_leaflet_box"},[t("leaflet-page",{key:e.catalog+e.type,attrs:{type:e.type,catalog:e.catalog,initZoom:e.saveZoom,initCenter:e.initCenter},on:{onZoom:e.onZoom,destroyZoom:e.destroyZoom,onClientRect:e.onClientRect}})],1):e._e()]:t("div",{staticClass:"empty_box"},[t("el-empty",{attrs:{description:"请选择目录","image-size":200}})],1),t("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"800px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[e.dialogVisible?t("CutSvgDialog",{on:{onSuccess:e.onSuccess},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}}):e._e()],1)],2)},p=[],m=(a(4114),function(){var e=this,t=e._self._c;return t("div",{staticClass:"leaflet_content",attrs:{id:e.catalog+e.type}})}),f=[],g=a(6886),y={data(){return{map:null,Grid:null,offSet:null,loadImages:[]}},methods:{drawGrid(e,t){const a=`${t.z},${t.x},${t.y}`;if(this.loadImages.includes(a))return!1;const o=this;this.map=e,this.Grid=new g.GridLayer({tileSize:512,noWrap:!0}),this.Grid.createTile=function(e){let n=g.DomUtil.create("canvas","leaflet-tile"),i=this.getTileSize();if(n.width=i.x,n.height=i.y,e.x===t.x&&e.y===t.y&&e.z===t.z){o.loadImages.push(a);let e=n.getContext("2d");var s=`${o.url}${o.catalog}/${o.newZoom}/${t.x}/${t.y}/1`,l=new Image;l.src=s,l.onload=function(){console.log(t),e.drawImage(l,0,0,i.x,i.y)}}return n},this.Grid.addTo(this.map)},canvansLineLat(e,t,a,o,n,i,s){const l=this.map.project({lat:e,lng:a.lng},o.z);l.y-o.y*n.y>=0&&l.y-o.y*n.y<=n.y&&(e-=this.offSet.lat,i.strokeStyle=s,i.beginPath(),i.moveTo(0,l.y-o.y*n.y-1),i.lineTo(n.y,l.y-o.y*n.y-1),i.closePath(),i.stroke(),this.canvansLineLat(e,t,a,o,n,i,s))},canvansLineLng(e,t,a,o,n,i,s){const l=this.map.project({lat:a.lat,lng:e},o.z);l.x-o.x*n.x>=0&&l.x-o.x*n.x<=n.x&&(e+=this.offSet.lng,i.strokeStyle=s,i.beginPath(),i.moveTo(Math.abs(l.x-o.x*n.x),0),i.lineTo(Math.abs(l.x-o.x*n.x),n.x),i.closePath(),i.stroke(),this.canvansLineLng(e,t,a,o,n,i,s))},latLngToTileNumber(e,t){const a=this.map.getZoom();return console.log(a),{x:Math.floor((t+180)/360*Math.pow(2,a)),y:Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,a)),z:a}}}},b={name:"LeafletPage",mixins:[y],props:{type:{type:String,default:""},catalog:{type:String,default:""},initZoom:{type:Number,default:1},initCenter:{type:Object,default:()=>({})}},data(){return{zoomMap:{1:1,2:2,3:5,4:10,5:20},map:null,boxRect:{width:0,height:0},newZoom:1,url:"/view/getImg/"}},methods:{initBox(){const{width:e,height:t}=this.$el.getBoundingClientRect();this.$set(this.boxRect,"width",e),this.$set(this.boxRect,"height",t),this.$nextTick((()=>{this.onLoad()}))},onLoad(){if(this.map=g.map(`${this.catalog}${this.type}`,{crs:g.CRS.Simple,center:[0,0],zoom:1,minZoom:1,maxZoom:5,zoomControl:!0,attributionControl:!1}),this.initCenter&&this.initCenter.lat&&this.initCenter.lng)this.map.setView([this.initCenter.lat,this.initCenter.lng]);else{const{lat:e,lng:t}=this.map.containerPointToLatLng({x:this.boxRect.width,y:this.boxRect.height});this.map.setView([e,t])}1!==this.initZoom&&this.map.setZoom(this.initZoom);let e=g.tileLayer("",{tileSize:512});e.getTileUrl=e=>{const{x:t,y:a,z:o}=e;return this.newZoom=this.zoomMap[o],`${this.url}${this.catalog}/${this.newZoom}/${t}/${a}/${this.type}`},e.addTo(this.map),this.map.on("click",(e=>{const t=e.latlng;let a=this.map.project(t,this.map.getZoom()).divideBy(512).floor();const o={x:a.x,y:a.y,z:this.map.getZoom()};this.drawGrid(this.map,o)}))},clearCacheAndReinitializeMap(){this.map.eachLayer((e=>{this.map.removeLayer(e)}))}},watch:{newZoom:{immediate:!0,handler:function(e){this.$emit("onZoom",e)}}},beforeDestroy(){if(this.map){const{lat:e,lng:t}=this.map.getCenter();this.$emit("onClientRect",{lat:e,lng:t});const a=this.map.getZoom();this.$emit("destroyZoom",a),this.clearCacheAndReinitializeMap()}},computed:{},mounted(){this.initBox()},created(){}},v=b,x=(0,r.A)(v,m,f,!1,null,"6d2d0ea8",null),w=x.exports,C=a(4660),_=a.n(C),$=a(5596),k=a.n($),L=a(4373),S=a(3518);o["default"].use(S.Ay);var j=new S.Ay.Store({state:{},getters:{},mutations:{},actions:{},modules:{}});const Z={401:"认证失败，无法访问系统资源",403:"当前操作没有权限",404:"访问资源不存在",default:"系统未知错误，请反馈给管理员"};L.A.defaults.headers["Content-Type"]="application/json;charset=utf-8";const P=L.A.create({baseURL:"",timeout:6e5});function T(e){return new Promise(((t,a)=>{let o=new FileReader;o.onload=function(){let e=o.result,t=JSON.parse(e);if("401"===t.header.code)jumpLogin(),a({message:"请登录"});else if("20000"===t.header.code)a(t.header);else{const e=t.header.message?t.header.message:"未知错误";k()({showClose:!0,message:e,type:"error"}),a({code:t.header.code,message:e})}},o.readAsText(e.data)}))}P.interceptors.request.use((e=>{if("get"===e.method&&e.params){let t=e.url+"?";for(const a of Object.keys(e.params)){const o=e.params[a];let n=encodeURIComponent(a)+"=";if(null!==o&&"undefined"!==typeof o)if("object"===typeof o)for(const e of Object.keys(o)){let n=a+"["+e+"]",i=encodeURIComponent(n)+"=";t+=i+encodeURIComponent(o[e])+"&"}else t+=n+encodeURIComponent(o)+"&"}t=t.slice(0,-1),e.params={},e.url=t}return e}),(e=>{Promise.reject(e)})),P.interceptors.response.use((async e=>{if("blob"!==e.config.responseType){const t=e.data.code||"200",a=Z[t]||e.data.msg||Z["default"];return 500===t?(k()({showClose:!0,message:a,type:"error"}),Promise.reject(a)):5001===t?Promise.reject(e.data.body.data):200!==t?(_().error({title:a}),Promise.reject("error")):{data:e.data.data,msg:e.data.msg}}if("[object Blob]"!==Object.prototype.toString.call(e.data))return Promise.reject(new Error("导出文件发生未知错误！"));if(!e.data.type.includes("application/json")){if(e.headers["content-disposition"]){const t=e.headers["content-disposition"].match(/(?<=filename=).*(?=;)/g)||e.headers["content-disposition"].match(/(?<=filename=).*/g)||[];return{blob:e.data,filename:t.join(",")?decodeURI(t.join(",")):""}}return k()({showClose:!0,message:"获取文件名失败",type:"error",duration:3e3}),Promise.reject("获取文件名失败！")}await T(e).then((()=>{})).catch((e=>Promise.reject(e)))}),(e=>{console.log("err"+e);let{message:t}=e;return"Network Error"==t?t="后端接口连接异常":t.includes("timeout")?t="系统接口请求超时":t.includes("Request failed with status code")&&(t="系统接口"+t.substr(t.length-3)+"异常"),k()({showClose:!0,message:t,type:"error",duration:3e3}),Promise.reject(e)}));var z=P;function M(){return z({url:"/view/getDirList",method:"get"})}function R(){return z({url:"/view/getImgList",method:"get"})}function O(e){return z({url:"/view/tileImg",method:"post",data:e})}var I=function(){var e=this,t=e._self._c;return t("div",{staticClass:"cutSvgDialog_box"},[t("div",{staticClass:"head_box"},[t("span",[e._v("文件状态：")]),t("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("div",{staticClass:"table_box"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"table_cut",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",size:"mini",height:"50vh"}},[t("el-table-column",{attrs:{width:"55",label:"选择",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-checkbox",{attrs:{"true-label":a.row.fileName},on:{change:e.changeSelect},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}})]}}])}),t("el-table-column",{attrs:{prop:"fileName",label:"文件名",align:"center"}}),t("el-table-column",{attrs:{prop:"status",label:"是否处理",align:"center",width:"220"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.status?t("span",[e._v("已处理")]):e._e(),0===a.row.status?t("span",[e._v("未处理")]):e._e()]}}])})],1)],1),t("div",{staticClass:"btn_footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSure}},[e._v("确定")])],1)])},V=[],A={name:"CutSvgDialog",model:{prop:"inputValue",event:"modelVal"},components:{},mixins:[],props:{inputValue:Boolean},data(){return{type:"",options:[{label:"全部",value:""},{label:"已处理",value:1},{label:"未处理",value:0}],tableData:[],tableList:[],checked:"",tableLoading:!1}},methods:{changeSelect(e){this.checked="",this.$nextTick((()=>{this.checked=e}))},init(){this.tableLoading=!0,R().then((e=>{this.tableList=e.data||[],this.handleChange(this.type)})).catch((()=>{})).finally((()=>{this.tableLoading=!1}))},handleChange(e){this.checked="",this.tableData=""!==e?this.tableList.filter((t=>t.status===e)):this.tableList},handleClose(){this.$emit("modelVal",!1)},handleSure(){if(!this.checked)return this.$message({showClose:!0,message:"请选择文件",type:"warning"}),!1;const e=this.$loading({lock:!0,text:"切片中..."}),t=new FormData;t.append("fileName",this.checked),O(t).then((t=>{e.close(),this.$message({showClose:!0,message:t.msg||"切片成功",type:"success"}),this.$emit("onSuccess")})).catch((()=>{e.close()}))}},watch:{type:{immediate:!0,handler:function(e){this.handleChange(e)}}},computed:{},mounted(){this.init()},created(){}},D=A,N=(0,r.A)(D,I,V,!1,null,"020b9cb9",null),U=N.exports,G={name:"MapDemo",components:{CutSvgDialog:U,LeafletPage:w},mixins:[],props:{},data(){return{dialogVisible:!1,type:"0",catalog:"",options:[],zoom:1,initCenter:{lat:0,lng:0},saveZoom:1,isLoad:!1}},methods:{init(){const e=this.$loading({lock:!0,text:"初始化中..."});M().then((e=>{for(let t=0,a=e.data.length;t<a;t++)this.options.push({label:e.data[t],value:e.data[t]})})).catch((()=>{})).finally((()=>{e.close()}))},handleChange(){this.isLoad=!1,this.saveZoom=1,this.$set(this.initCenter,"lat",0),this.$set(this.initCenter,"lng",0),this.$nextTick((()=>{this.isLoad=!0}))},onZoom(e){this.zoom=e},onClientRect(e){this.$set(this.initCenter,"lat",e.lat),this.$set(this.initCenter,"lng",e.lng)},destroyZoom(e){this.saveZoom=e},onSuccess(){this.dialogVisible=!1,this.init()}},watch:{},computed:{},mounted(){this.init()},created(){}},B=G,E=(0,r.A)(B,h,p,!1,null,"54e9c98a",null),F=E.exports;o["default"].use(d.Ay);const q=[{path:"/",name:"home",component:F}],J=new d.Ay({mode:"history",routes:q});var W=J,X=a(3832),H=a.n(X),K=a(4355),Q=a.n(K),Y=a(3194),ee=a.n(Y),te=a(3950),ae=a.n(te),oe=a(4351),ne=a.n(oe),ie=a(5125),se=a.n(ie),le=a(6272),re=a.n(le),ce=a(3797),ue=a.n(ce),de=a(353),he=a.n(de),pe=a(3952),me=a.n(pe),fe=a(630),ge=a.n(fe),ye=a(1120),be=a.n(ye),ve=a(874),xe=a.n(ve),we=a(2672),Ce=a.n(we),_e=a(4054),$e=a.n(_e),ke=a(6210),Le=a.n(ke),Se=a(1275),je=a.n(Se),Ze=a(4621),Pe=a.n(Ze),Te=a(9507),ze=a.n(Te),Me=a(3436),Re=a.n(Me),Oe=a(1362),Ie=a.n(Oe),Ve=a(5319),Ae=a.n(Ve),De=a(8339),Ne=a.n(De),Ue=a(9940),Ge=a.n(Ue),Be=a(6535),Ee=a.n(Be),Fe=a(1178),qe=a.n(Fe),Je=a(2381),We=a.n(Je),Xe=a(1227),He=a.n(Xe),Ke=a(5235),Qe=a.n(Ke),Ye=a(175),et=a.n(Ye),tt=a(7999),at=a.n(tt);o["default"].prototype.$ELEMENT={size:"small"},o["default"].use(at()),o["default"].use(et()),o["default"].use(Qe()),o["default"].use(He()),o["default"].use(We()),o["default"].use(qe()),o["default"].use(Ee()),o["default"].use(Ge()),o["default"].use(Ne()),o["default"].use(Ae()),o["default"].use(Ie()),o["default"].use(Re()),o["default"].use(ze()),o["default"].use(Pe()),o["default"].use(je()),o["default"].use(Le()),o["default"].use($e()),o["default"].use(Ce()),o["default"].use(xe()),o["default"].use(be()),o["default"].use(ge()),o["default"].use(me()),o["default"].use(he()),o["default"].use(ue()),o["default"].use(re()),o["default"].use(se()),o["default"].use(ne()),o["default"].use(ae()),o["default"].use(ee()),o["default"].use(Q().directive),o["default"].prototype.$loading=Q().service,o["default"].prototype.$msgbox=H(),o["default"].prototype.$alert=H().alert,o["default"].prototype.$confirm=H().confirm,o["default"].prototype.$prompt=H().prompt,o["default"].prototype.$notify=_(),o["default"].prototype.$message=k(),o["default"].config.productionTip=!1,new o["default"]({router:W,store:j,render:e=>e(u)}).$mount("#app")}},t={};function a(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,a),i.exports}a.m=e,function(){var e=[];a.O=function(t,o,n,i){if(!o){var s=1/0;for(u=0;u<e.length;u++){o=e[u][0],n=e[u][1],i=e[u][2];for(var l=!0,r=0;r<o.length;r++)(!1&i||s>=i)&&Object.keys(a.O).every((function(e){return a.O[e](o[r])}))?o.splice(r--,1):(l=!1,i<s&&(s=i));if(l){e.splice(u--,1);var c=n();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[o,n,i]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,o){var n,i,s=o[0],l=o[1],r=o[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(n in l)a.o(l,n)&&(a.m[n]=l[n]);if(r)var u=r(a)}for(t&&t(o);c<s.length;c++)i=s[c],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(u)},o=self["webpackChunkleafletjs_66"]=self["webpackChunkleafletjs_66"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=a.O(void 0,[504],(function(){return a(3914)}));o=a.O(o)})();